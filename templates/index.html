<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZOF Polynomial Solver</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; color: #333; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #3498db; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; transition: background 0.3s; }
        button:hover { background-color: #2980b9; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #2c3e50; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        
        .result-box { margin-top: 20px; padding: 15px; border-radius: 5px; text-align: center; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .hidden { display: none; }
        .note { font-size: 0.8em; color: #666; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ZOF Polynomial Solver</h1>
    
    <form method="POST" action="/">
        <div class="form-group">
            <label for="method">Numerical Method</label>
            <select id="method" name="method" onchange="updateForm()">
                <option value="bisection" {% if inputs.get('method') == 'bisection' %}selected{% endif %}>Bisection Method</option>
                <option value="regula_falsi" {% if inputs.get('method') == 'regula_falsi' %}selected{% endif %}>Regula Falsi</option>
                <option value="secant" {% if inputs.get('method') == 'secant' %}selected{% endif %}>Secant Method</option>
                <option value="newton" {% if inputs.get('method') == 'newton' %}selected{% endif %}>Newton-Raphson</option>
                <option value="fixed_point" {% if inputs.get('method') == 'fixed_point' %}selected{% endif %}>Fixed Point Iteration</option>
                <option value="modified_secant" {% if inputs.get('method') == 'modified_secant' %}selected{% endif %}>Modified Secant</option>
            </select>
        </div>

        <div class="form-group">
            <label>Coefficients (space separated, highest power first)</label>
            <input type="text" name="coeffs" placeholder="e.g., 1 -4 (for x^2 - 4)" value="{{ inputs.get('coeffs_str', '') }}" required>
            <div class="note" id="coeff-note">Equation: a_n*x^n + ... + a_0</div>
        </div>

        <div class="form-group">
            <label id="label-x0">Initial Guess / Lower Bound (a or x0)</label>
            <input type="number" step="any" name="x0" value="{{ inputs.get('x0', '') }}" required>
        </div>

        <div class="form-group" id="group-x1">
            <label id="label-x1">Upper Bound / Second Guess (b or x1)</label>
            <input type="number" step="any" name="x1" value="{{ inputs.get('x1', '') }}">
        </div>

        <div class="form-group hidden" id="group-delta">
            <label>Perturbation Delta</label>
            <input type="number" step="any" name="delta" value="{{ inputs.get('delta', 0.01) }}">
        </div>

        <div class="form-group" style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>Tolerance</label>
                <input type="number" step="any" name="tol" value="{{ inputs.get('tol', 0.0001) }}" required>
            </div>
            <div style="flex: 1;">
                <label>Max Iterations</label>
                <input type="number" name="max_iter" value="{{ inputs.get('max_iter', 10) }}" required>
            </div>
        </div>

        <button type="submit">Solve Equation</button>
    </form>

    {% if error %}
        <div class="result-box fail">{{ error }}</div>
    {% endif %}

    {% if result %}
        <div class="result-box {{ 'success' if result.converged else 'fail' }}">
            <h3>Final Root: {{ "{:.6f}".format(result.root) }}</h3>
            <p>{{ result.msg }}</p>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Iter</th>
                    {% if result.iterations[0].get('a') is not none %} <th>a (Low)</th> {% endif %}
                    {% if result.iterations[0].get('b') is not none %} <th>b (High)</th> {% endif %}
                    {% if result.iterations[0].get('x_prev') is not none %} <th>x_prev</th> {% endif %}
                    {% if result.iterations[0].get('x_curr') is not none %} <th>x_curr</th> {% endif %}
                    <th>Calculated Root (x)</th>
                    {% if result.iterations[0].get('f_x') is not none %} <th>f(x)</th> {% endif %}
                    <th>Error</th>
                </tr>
            </thead>
            <tbody>
                {% for row in result.iterations %}
                <tr>
                    <td>{{ row.iter }}</td>
                    {% if row.get('a') is not none %} <td>{{ "{:.6f}".format(row.a) }}</td> {% endif %}
                    {% if row.get('b') is not none %} <td>{{ "{:.6f}".format(row.b) }}</td> {% endif %}
                    {% if row.get('x_prev') is not none %} <td>{{ "{:.6f}".format(row.x_prev) }}</td> {% endif %}
                    {% if row.get('x_curr') is not none %} <td>{{ "{:.6f}".format(row.x_curr) }}</td> {% endif %}
                    
                    <td style="font-weight: bold;">{{ "{:.6f}".format(row.x_val) }}</td>
                    
                    {% if row.get('f_x') is not none %} <td>{{ "{:.6f}".format(row.f_x) }}</td> {% endif %}
                    <td>{{ "{:.6f}".format(row.error) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>

<script>
    function updateForm() {
        const method = document.getElementById('method').value;
        const groupX1 = document.getElementById('group-x1');
        const groupDelta = document.getElementById('group-delta');
        const labelX0 = document.getElementById('label-x0');
        const labelX1 = document.getElementById('label-x1');
        const coeffNote = document.getElementById('coeff-note');

        // Reset visibility
        groupX1.classList.remove('hidden');
        groupDelta.classList.add('hidden');

        if (method === 'bisection' || method === 'regula_falsi') {
            labelX0.innerText = "Lower Bound (a)";
            labelX1.innerText = "Upper Bound (b)";
            coeffNote.innerText = "Function P(x) coefficients";
        } 
        else if (method === 'secant') {
            labelX0.innerText = "First Guess (x0)";
            labelX1.innerText = "Second Guess (x1)";
            coeffNote.innerText = "Function P(x) coefficients";
        } 
        else if (method === 'newton') {
            labelX0.innerText = "Initial Guess (x0)";
            groupX1.classList.add('hidden');
            coeffNote.innerText = "Function P(x) coefficients (Derivative P'(x) calculated automatically)";
        } 
        else if (method === 'fixed_point') {
            labelX0.innerText = "Initial Guess (x0)";
            groupX1.classList.add('hidden');
            coeffNote.innerText = "Enter coefficients for g(x) where x = g(x)";
        } 
        else if (method === 'modified_secant') {
            labelX0.innerText = "Initial Guess (x0)";
            groupX1.classList.add('hidden');
            groupDelta.classList.remove('hidden');
            coeffNote.innerText = "Function P(x) coefficients";
        }
    }

    // Initialize on load
    window.onload = updateForm;
</script>

</body>
</html>